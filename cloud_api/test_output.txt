
> ytdlp-sizer-api@2.0.0 test
> jest --coverage --detectOpenHandles --forceExit --testPathIgnorePatterns=integration.test.js

FAIL tests/server.test.js
  ● Cloud API Server › API v1 Endpoints › POST /api/v1/size › should reject invalid duration_hint

    expect(received).toEqual(expected) // deep equality

    Expected: ArrayContaining [ObjectContaining {"field": "duration_hint", "message": StringMatching /duration_hint/i}]
    Received: [{"field": "duration_hint", "message": "Expected number, received string"}]

      198 |                 expect(response.body).toHaveProperty("ok", false);
      199 |                 expect(response.body.error).toBe("Validation failed");
    > 200 |                 expect(response.body.details).toEqual(
          |                                               ^
      201 |                     expect.arrayContaining([
      202 |                         expect.objectContaining({
      203 |                             field: "duration_hint",

      at Object.toEqual (tests/server.test.js:200:47)

PASS tests/worker-pool.test.js
-----------|---------|----------|---------|---------|-----------------------------------------------------------
File       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                         
-----------|---------|----------|---------|---------|-----------------------------------------------------------
All files  |   47.24 |       30 |   14.28 |   48.33 |                                                           
 server.js |   47.24 |       30 |   14.28 |   48.33 | 70,74,78,82-83,95-119,124-129,133-135,162,238-315,323-325 
-----------|---------|----------|---------|---------|-----------------------------------------------------------

Test Suites: 1 failed, 1 passed, 2 total
Tests:       1 failed, 31 passed, 32 total
Snapshots:   0 total
Time:        6.128 s, estimated 7 s
Ran all test suites.

Jest has detected the following 2 open handles potentially keeping Jest from exiting:

  ●  Piscina

      69 |
      70 |         // Create Piscina instance
    > 71 |         this.piscina = new Piscina({
         |                        ^
      72 |             filename: this.workerScript,
      73 |             minThreads: this.minWorkers,
      74 |             maxThreads: this.maxWorkers,

      at new Piscina (node_modules/piscina/src/index.ts:710:5)
      at new WorkerPool (worker-pool.js:71:24)
      at Object.<anonymous> (tests/worker-pool.test.js:18:16)


  ●  Piscina

      69 |
      70 |         // Create Piscina instance
    > 71 |         this.piscina = new Piscina({
         |                        ^
      72 |             filename: this.workerScript,
      73 |             minThreads: this.minWorkers,
      74 |             maxThreads: this.maxWorkers,

      at new Piscina (node_modules/piscina/src/index.ts:710:5)
      at new WorkerPool (worker-pool.js:71:24)
      at Object.<anonymous> (server.js:60:20)
      at Object.require (tests/worker-pool.test.js:96:15)

